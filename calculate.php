<?php
$accompanyImages = array("images/t-shirt.gif","images/vneckt.gif","images/ziphoodie.gif","images/pulloverhoodie.gif","images/longsleeve.gif","images/golf.gif","images/cust-supplied.gif");
$garmentArray = array();
$garmentArray[0]["info"][] = array("id"=>0 ,"garName"=>"Fruit/Gildan/Jerzees 100% or 50/50 Cotton");
$garmentArray[0]["price"][] = "2.70";
$garmentArray[0]["link"][] = "http://www.catalogsportswear.com/cgi-bin/hw/webshr/colorChart.w?sc=G500&h=hosted&noCache=5020111308439635771";
$garmentArray[0]["accImm"][] = 0;
$garmentArray[0]["info"][] = array("id"=>1 ,"garName"=>"Ring spun 100% Cotton");
$garmentArray[0]["price"][] = "3.55";
$garmentArray[0]["link"][] = "";
$garmentArray[0]["accImm"][] = 0;
$garmentArray[0]["info"][] = array("id"=>2 ,"garName"=>"American App. 2001 or 2102 100% Cotton");
$garmentArray[0]["price"][] = "5.30";
$garmentArray[0]["link"][] = "http://www.americanapparel.net/morephotos/viewer.asp?style=2001&n=Fine%20Jersey%3Cbr%3EShort%20Sleeve%20T-Shirt";
$garmentArray[0]["accImm"][] = 0;
$garmentArray[0]["info"][] = array("id"=>3 ,"garName"=>"American App. BB401 50/50");
$garmentArray[0]["price"][] = "5.70";
$garmentArray[0]["link"][] = "http://www.americanapparel.net/morephotos/viewer.asp?style=BB401&n=Poly-Cotton%3Cbr%3EShort%20Sleeve%20Crew%20Neck";
$garmentArray[0]["accImm"][] = 0;
$garmentArray[0]["info"][] = array("id"=>4 ,"garName"=>"American App. TR401 Tri-Blend");
$garmentArray[0]["price"][] = "7.00";
$garmentArray[0]["link"][] = "http://www.americanapparel.net/morephotos/viewer.asp?style=TR401&n=Tri-Blend%3Cbr%3EShort%20Sleeve%20Track%20Shirt";
$garmentArray[0]["accImm"][] = 0;
$garmentArray[0]["info"][] = array("id"=>5 ,"garName"=>"Tul-tex 100% Cotton");
$garmentArray[0]["price"][] = "3.10";
$garmentArray[0]["link"][] = "";
$garmentArray[0]["accImm"][] = 0;

$garmentArray[1]["info"][] = array("id"=>0 ,"garName"=>"American App. 2456");
$garmentArray[1]["price"][] = "5.95";
$garmentArray[1]["link"][] = "http://www.americanapparel.net/morephotos/viewer.asp?style=2456&n=Fine%20Jersey%3Cbr%3EShort%20Sleeve%20V-Neck";
$garmentArray[1]["accImm"][] = 1;
$garmentArray[1]["info"][] = array("id"=>1 ,"garName"=>"American App. Deep V 6456");
$garmentArray[1]["price"][] = "7.15";
$garmentArray[1]["link"][] = "http://www.americanapparel.net/morephotos/viewer.asp?style=6456&n=Sheer%20Jersey%20Short%20Sleeve%20Deep%20V-Neck";
$garmentArray[1]["accImm"][] = 1;

$garmentArray[2]["info"][] = array("id"=>0 ,"garName"=>"Fruit/Gildan/Jerzees 8oz 50/50");
$garmentArray[2]["price"][] = "15.15";
$garmentArray[2]["link"][] = "http://www.catalogsportswear.com/cgi-bin/hw/webshr/colorChart.w?sc=996&h=hosted&noCache=5020111308440812361";
$garmentArray[2]["accImm"][] = 2;
$garmentArray[2]["info"][] = array("id"=>1 ,"garName"=>"Fruit/Gildan/Jerzees 9.5oz 50/50");
$garmentArray[2]["price"][] = "20.15";
$garmentArray[2]["link"][] = "http://www.catalogsportswear.com/cgi-bin/hw/webshr/colorChart.w?sc=4999&h=hosted&noCache=5020111308440799724";
$garmentArray[2]["accImm"][] = 2;
$garmentArray[2]["info"][] = array("id"=>2 ,"garName"=>"American App. 5497");
$garmentArray[2]["price"][] = "21.55";
$garmentArray[2]["link"][] = "http://www.americanapparel.net/morephotos/viewer.asp?style=5497&n=California%20Fleece%3Cbr%3EZip%20Hoody";
$garmentArray[2]["accImm"][] = 2;
$garmentArray[2]["info"][] = array("id"=>3 ,"garName"=>"American App. FlexFleece F497");
$garmentArray[2]["price"][] = "20.50";
$garmentArray[2]["link"][] = "http://www.americanapparel.net/morephotos/viewer.asp?style=F497&n=Flex%20Fleece%3Cbr%3EZip%20Hoody";
$garmentArray[2]["accImm"][] = 2;

$garmentArray[3]["info"][] = array("id"=>0 ,"garName"=>"Fruit/Gildan/Jerzees 8oz 50/50 Cotton");
$garmentArray[3]["price"][] = "11.05";
$garmentArray[3]["link"][] = "http://www.catalogsportswear.com/cgi-bin/hw/webshr/colorChart.w?sc=16130&h=hosted&noCache=5020111308440399268";
$garmentArray[3]["accImm"][] = 3;
$garmentArray[3]["info"][] = array("id"=>1 ,"garName"=>"Fruit/Gildan/Jerzees 9.5oz 50/50 Cotton");
$garmentArray[3]["price"][] = "13.60";
$garmentArray[3]["link"][] = "http://www.catalogsportswear.com/cgi-bin/hw/webshr/colorChart.w?sc=4997&h=hosted&noCache=5020111308440432619";
$garmentArray[3]["accImm"][] = 3;
$garmentArray[3]["info"][] = array("id"=>2 ,"garName"=>"American App. 5495");
$garmentArray[3]["price"][] = "17.60";
$garmentArray[3]["link"][] = "http://www.americanapparel.net/morephotos/viewer.asp?style=5495&n=California%20Fleece%3Cbr%3EPullover%20Hoody";
$garmentArray[3]["accImm"][] = 3;

$garmentArray[4]["info"][] = array("id"=>0 ,"garName"=>"Fruit/Gildan/Jerzees 100% or 50/50 Cotton");
$garmentArray[4]["price"][] = "4.55";
$garmentArray[4]["link"][] = "http://www.catalogsportswear.com/cgi-bin/hw/webshr/colorChart.w?sc=4930&h=hosted&noCache=5020111308440479949";
$garmentArray[4]["accImm"][] = 4;

$garmentArray[5]["info"][] = array("id"=>0 ,"garName"=>"Generic Golf/Sport 100% or 50/50 Cotton");
$garmentArray[5]["price"][] = "6.15";
$garmentArray[5]["link"][] = "http://www.catalogsportswear.com/cgi-bin/hw/webshr/colorChart.w?sc=437&h=hosted&noCache=5020111308440577529";
$garmentArray[5]["accImm"][] = 5;
$garmentArray[5]["info"][] = array("id"=>1 ,"garName"=>"Generic Golf/Sport 100% or 50/50 Cotton W/Pocket");
$garmentArray[5]["price"][] = "7.55";
$garmentArray[5]["link"][] = "http://www.catalogsportswear.com/cgi-bin/hw/webshr/colorChart.w?sc=436P&h=hosted&noCache=5020111308440564260";
$garmentArray[5]["accImm"][] = 5;

$garmentArray[6]["info"][] = array("id"=>0 ,"garName"=>"Customer Supplied");
$garmentArray[6]["price"][] = "0.50";
$garmentArray[6]["link"][] = "";
$garmentArray[6]["accImm"][] = 6;

$garmentArray[7]["info"][] = array("id"=>0 ,"garName"=>"Enter Custom Item Cost Below.");
$garmentArray[7]["price"][] = "0";
$garmentArray[7]["link"][] = "";
$garmentArray[7]["accImm"][] = 6;


$locCost = 0.10;

if(isset($_POST['qty'])){

$qty = $_POST[qty]; // this comes from a form obviously
$garmentStyle = $_POST[garmentStyle];
$garmentType = $_POST[garmentType];
$taxDeduct = ($_POST[taxdeduct] == "on") ? 1 : 0 ;
$discCode = $_POST[disc];


$garmentMarkUp = $garmentArray[$garmentType]["price"][$garmentStyle];

if($garmentType == 7){
	// custom price quote item cost
	$garmentMarkUp = $_POST[custom];
}

// calculate number of colors
$printColors_front = $_POST["colors-front"];
$printColors_back = $_POST["colors-back"];
$printColors_left = $_POST["colors-left"];
$printColors_right = $_POST["colors-right"];
$printColors_other = $_POST["colors-other"];

}else{
  
  $qty = 96; // this will give us an upsell suggestion
  $garmentStyle = 0;
  $garmentType = 0;
  $taxDeduct = 0;
  $discCode = 0;
  $garmentMarkUp = $garmentArray[$garmentType]["price"][$garmentStyle];
  
  // calculate number of colors
  $printColors_front = 1;
  $printColors_back = 2;
  $printColors_left = 0;
  $printColors_right = 0;
  $printColors_other = 0;
  
  
}

$locationMrkUps = 0;
if($printColors_front)
	$locationMrkUps += $locCost;
if($printColors_back)
	$locationMrkUps += $locCost;
if($printColors_left)
	$locationMrkUps += $locCost;
if($printColors_right)
	$locationMrkUps += $locCost;
if($printColors_other)
	$locationMrkUps += $locCost;

$priceArray = array();
// the zero after price array is the item type.
$priceArray[0]["perColor"][] = 1.5;
$priceArray[0]["markUp"][0][] = 5.15;
$priceArray[0]["perColor"][] = 1.35;
$priceArray[0]["markUp"][0][] = 3.4;
$priceArray[0]["perColor"][] = 1.25;
$priceArray[0]["markUp"][0][] = 1.9;
$priceArray[0]["perColor"][] = 1.1;
$priceArray[0]["markUp"][0][] = 1.9;
$priceArray[0]["perColor"][] = 0.85;
$priceArray[0]["markUp"][0][] = 2;
$priceArray[0]["perColor"][] = 0.8;
$priceArray[0]["markUp"][0][] = 1.95;
$priceArray[0]["perColor"][] = 0.75;
$priceArray[0]["markUp"][0][] = 1.9;
$priceArray[0]["perColor"][] = 0.65;
$priceArray[0]["markUp"][0][] = 1.95;
$priceArray[0]["perColor"][] = 0.6;
$priceArray[0]["markUp"][0][] = 1.95;
$priceArray[0]["perColor"][] = 0.6;
$priceArray[0]["markUp"][0][] = 1.9;
$priceArray[0]["perColor"][] = 0.6;
$priceArray[0]["markUp"][0][] = 1.85;
$priceArray[0]["perColor"][] = 0.55;
$priceArray[0]["markUp"][0][] = 1.87;
$priceArray[0]["perColor"][] = 0.55;
$priceArray[0]["markUp"][0][] = 1.85;
$priceArray[0]["perColor"][] = 0.5;
$priceArray[0]["markUp"][0][] = 1.87;
$priceArray[0]["perColor"][] = 0.5;
$priceArray[0]["markUp"][0][] = 1.85;
$priceArray[0]["perColor"][] = 0.4;
$priceArray[0]["markUp"][0][] = 1.9;
$priceArray[0]["perColor"][] = 0.35;
$priceArray[0]["markUp"][0][] = 1.9;
$priceArray[0]["perColor"][] = 0.35;
$priceArray[0]["markUp"][0][] = 1.85;
$priceArray[0]["perColor"][] = 0.35;
$priceArray[0]["markUp"][0][] = 1.8;
$priceArray[0]["perColor"][] = 0.35;
$priceArray[0]["markUp"][0][] = 1.6;
$priceArray[0]["perColor"][] = 0.3;
$priceArray[0]["markUp"][0][] = 1.6;
$priceArray[0]["perColor"][] = 0.29;
$priceArray[0]["markUp"][0][] = 1.59;
$priceArray[0]["perColor"][] = 0.28;
$priceArray[0]["markUp"][0][] = 1.58;
$priceArray[0]["perColor"][] = 0.27;
$priceArray[0]["markUp"][0][] = 1.57;
$priceArray[0]["perColor"][] = 0.25;
$priceArray[0]["markUp"][0][] = 1.57;
$priceArray[0]["perColor"][] = 0.25;
$priceArray[0]["markUp"][0][] = 1.55;
$priceArray[0]["perColor"][] = 0.25;
$priceArray[0]["markUp"][0][] = 1.53;
$priceArray[0]["perColor"][] = 0.24;
$priceArray[0]["markUp"][0][] = 1.52;
$priceArray[0]["perColor"][] = 0.24;
$priceArray[0]["markUp"][0][] = 1.5;
$priceArray[0]["perColor"][] = 0.24;
$priceArray[0]["markUp"][0][] = 1.48;
$priceArray[0]["perColor"][] = 0.22;
$priceArray[0]["markUp"][0][] = 1.48;
$priceArray[0]["perColor"][] = 0.22;
$priceArray[0]["markUp"][0][] = 1.46;
$priceArray[0]["perColor"][] = 0.2;
$priceArray[0]["markUp"][0][] = 1.45;

if($qty > 11){
$remainingToUpsell = 0;
switch ($qty) {

	case ($qty > 11 && $qty < 18):
		// use the right array placement
		$qtyVar = 0;
		$nextBreak = ($qty < 17) ? $qtyVar+1 : $qtyVar;
		$remainingToUpsell = 18 - $qty;
	break;
	
	case ($qty > 17 && $qty < 24):
		$qtyVar = 1;
		$nextBreak = ($qty < 23) ? $qtyVar+1 : $qtyVar;
		$remainingToUpsell = 24 - $qty;
	break;
	
	case ($qty > 23 && $qty < 30):
		$qtyVar = 2;
		$nextBreak = ($qty < 29) ? $qtyVar+1 : $qtyVar;
		$remainingToUpsell = 30 - $qty;
	break;
	
	case ($qty > 29 && $qty < 36):
		$qtyVar = 3;
		$nextBreak = ($qty < 35) ? $qtyVar+1 : $qtyVar;
		$remainingToUpsell = 36 - $qty;
	break;
	
	case ($qty > 35 && $qty < 41):
		$qtyVar = 4;
		$nextBreak = ($qty < 40) ? $qtyVar+1 : $qtyVar;
		$remainingToUpsell = 41 - $qty;
	break;
	
	case ($qty > 40 && $qty < 48):
		$qtyVar = 5;
		$nextBreak = ($qty < 47) ? $qtyVar+1 : $qtyVar;
		$remainingToUpsell = 48 - $qty;
	break;
	
	case ($qty > 47 && $qty < 54):
		$qtyVar = 6;
		$nextBreak = ($qty < 54) ? $qtyVar+1 : $qtyVar;
		$remainingToUpsell = 54 - $qty;
	break;
	
	case ($qty > 53 && $qty < 60):
		$qtyVar = 7;
		$nextBreak = ($qty < 59) ? $qtyVar+1 : $qtyVar;
		$remainingToUpsell = 60 - $qty;
	break;
	
	case ($qty > 59 && $qty < 66):
		$qtyVar = 8;
		$nextBreak = ($qty < 65) ? $qtyVar+1 : $qtyVar;
		$remainingToUpsell = 66 - $qty;
	break;
	
	case ($qty > 65 && $qty < 72):
		$qtyVar = 9;
		$nextBreak = ($qty < 71) ? $qtyVar+1 : $qtyVar;
		$remainingToUpsell = 72 - $qty;
	break;
	
	case ($qty > 71 && $qty < 78):
		$qtyVar = 10;
		$nextBreak = ($qty < 77) ? $qtyVar+1 : $qtyVar;
		$remainingToUpsell = 78 - $qty;
	break;
	
	case ($qty > 77 && $qty < 85):
		$qtyVar = 11;
		$nextBreak = ($qty < 76) ? $qtyVar+1 : $qtyVar;
		$remainingToUpsell = 85 - $qty;
	break;
	
	case ($qty > 84 && $qty < 90):
		$qtyVar = 12;
		$nextBreak = ($qty < 89) ? $qtyVar+1 : $qtyVar;
		$remainingToUpsell = 90 - $qty;
	break;
	
	case ($qty > 89 && $qty < 96):
		$qtyVar = 13;
		$nextBreak = ($qty < 95) ? $qtyVar+1 : $qtyVar;
		$remainingToUpsell = 96 - $qty;
	break;
	
	case ($qty > 95 && $qty < 100):
		$qtyVar = 14;
		$nextBreak = ($qty < 99) ? $qtyVar+1 : $qtyVar;
		$remainingToUpsell = 100 - $qty;
	break;
	
	case ($qty > 99 && $qty < 125):
		$qtyVar = 15;
		$nextBreak = ($qty < 124) ? $qtyVar+1 : $qtyVar;
		$remainingToUpsell = 125 - $qty;
	break;
	
	case ($qty > 124 && $qty < 150):
		$qtyVar = 16;
		$nextBreak = ($qty < 149) ? $qtyVar+1 : $qtyVar;
		$remainingToUpsell = 150 - $qty;
	break;
	
	case ($qty > 149 && $qty < 175):
		$qtyVar = 17;
		$nextBreak = ($qty < 174) ? $qtyVar+1 : $qtyVar;
		$remainingToUpsell = 175 - $qty;
	break;
	
	case ($qty > 174 && $qty < 200):
		$qtyVar = 18;
		$nextBreak = ($qty < 199) ? $qtyVar+1 : $qtyVar;
		$remainingToUpsell = 200 - $qty;
	break;
	
	case ($qty > 199 && $qty < 251):
		$qtyVar = 19;
		$nextBreak = ($qty < 250) ? $qtyVar+1 : $qtyVar;
		$remainingToUpsell = 251 - $qty;
	break;
	
	case ($qty > 250 && $qty < 301):
		$qtyVar = 20;
		$nextBreak = ($qty < 300) ? $qtyVar+1 : $qtyVar;
		$remainingToUpsell = 301 - $qty;
	break;
	
	case ($qty > 300 && $qty < 401):
		$qtyVar = 21;
		$nextBreak = ($qty < 400) ? $qtyVar+1 : $qtyVar;
		$remainingToUpsell = 401 - $qty;
	break;
	
	case ($qty > 400 && $qty < 501):
		$qtyVar = 22;
		$nextBreak = ($qty < 500) ? $qtyVar+1 : $qtyVar;
		$remainingToUpsell = 501 - $qty;
	break;
	
	case ($qty > 500 && $qty < 601):
		$qtyVar = 23;
		$nextBreak = ($qty < 600) ? $qtyVar+1 : $qtyVar;
		$remainingToUpsell = 601 - $qty;
	break;
	
	case ($qty > 600 && $qty < 701):
		$qtyVar = 24;
		$nextBreak = ($qty < 700) ? $qtyVar+1 : $qtyVar;
		$remainingToUpsell = 701 - $qty;
	break;
	
	case ($qty > 700 && $qty < 801):
		$qtyVar = 25;
		$nextBreak = ($qty < 800) ? $qtyVar+1 : $qtyVar;
		$remainingToUpsell = 801 - $qty;
	break;
	
	case ($qty > 800 && $qty < 901):
		$qtyVar = 26;
		$nextBreak = ($qty < 900) ? $qtyVar+1 : $qtyVar;
		$remainingToUpsell = 901 - $qty;
	break;
	
	case ($qty > 900 && $qty < 1001):
		$qtyVar = 27;
		$nextBreak = ($qty < 1000) ? $qtyVar+1 : $qtyVar;
		$remainingToUpsell = 1001 - $qty;
	break;
	
	case ($qty > 1000 && $qty < 1501):
		$qtyVar = 28;
		$nextBreak = ($qty < 1500) ? $qtyVar+1 : $qtyVar;
		$remainingToUpsell = 1501 - $qty;
	break;
	
	case ($qty > 1500 && $qty < 2001):
		$qtyVar = 29;
		$nextBreak = ($qty < 2000) ? $qtyVar+1 : $qtyVar;
		$remainingToUpsell = 2001 - $qty;
	break;
	
	case ($qty > 2000 && $qty < 2501):
		$qtyVar = 30;
		$nextBreak = ($qty < 2500) ? $qtyVar+1 : $qtyVar;
		$remainingToUpsell = 2501 - $qty;
	break;
	
	case ($qty > 2500 && $qty < 3000):
		$qtyVar = 31;
		$nextBreak = ($qty < 2999) ? $qtyVar+1 : $qtyVar;
		$remainingToUpsell = 3000 - $qty;
	break;
	
	case ($qty > 2999):
		$qtyVar = 32;
		$nextBreak = $qtyVar;
	break;
	
	
	

}

//$data[$q]["locationMrkUps"] = $locationMrkUps;
//$data[$q]["garmentMarkUp"] = $garmentMarkUp;

function formatMoney($val,$sign = "$"){
  return $sign.$val;
}

function doGarmentCalc($d,$c,$priceArray,$garmentArray){
  $returned = array();
  $accompanyImages = array("images/t-shirt.gif","images/vneckt.gif","images/ziphoodie.gif","images/pulloverhoodie.gif","images/longsleeve.gif","images/golf.gif","images/cust-supplied.gif");
  
  $fc = $d['printColors_front'] * $priceArray[0]["perColor"][$d['qtyVar']];
  $bc = $d['printColors_back'] * $priceArray[0]["perColor"][$d['qtyVar']];
  $lc = $d['printColors_left'] * $priceArray[0]["perColor"][$d['qtyVar']];
  $rc = $d['printColors_right'] * $priceArray[0]["perColor"][$d['qtyVar']];
  $oc = $d['printColors_other'] * $priceArray[0]["perColor"][$d['qtyVar']];

  $garmentMarkUp = $garmentArray[$d['garmentType']]["price"][$c];

  // always comment out the 3 lines below
  //$returned['qtyVar'] = $d['qtyVar'];
  //$returned['markupVar'] = $priceArray[0]["markUp"][0][$d['qtyVar']];
  //$returned['perColor'] = $priceArray[0]["perColor"][$d['qtyVar']];

  $printPrice = $priceArray[0]["markUp"][0][$d['qtyVar']] + ($fc + $bc + $lc + $rc + $oc) + $d['locationMrkUps'] + $garmentMarkUp;
  
  $subTotal = ($printPrice * $d['qty']);
  $taxTotal = $subTotal * 0.06;
  if($d['taxDeduct']){$taxTotal = 0;}
  $quoteTotal = ($printPrice * $d['qty']) + number_format($taxTotal, 2, '.', '');
  $piecePrice = $quoteTotal / $d['qty'];
  
  
  if($d['nextBreak'] != $d['qtyVar']){
    $fcUp = $d['printColors_front'] * $priceArray[0]["perColor"][$d['nextBreak']];
    $bcUp = $d['printColors_back'] * $priceArray[0]["perColor"][$d['nextBreak']];
    $lcUp = $d['printColors_left'] * $priceArray[0]["perColor"][$d['nextBreak']];
    $rcUp = $d['printColors_right'] * $priceArray[0]["perColor"][$d['nextBreak']];
    $oUpc = $d['printColors_other'] * $priceArray[0]["perColor"][$d['nextBreak']];
    $printPriceUpsell = $priceArray[0]["markUp"][0][$d['nextBreak']] + ($fcUp + $bcUp + $lcUp + $rcUp + $ocUp) + $d['locationMrkUps'] + $garmentMarkUp;
    $subTotalUpsell = ($printPriceUpsell * $d['qty']);
    $taxTotalUpsell = $subTotalUpsell * 0.06;
    if($d['taxDeduct']){$taxTotalUpsell = 0;}
    $quoteTotalUpsell = ($printPriceUpsell * $d['qty']) + number_format($taxTotalUpsell, 2, '.', '');
    $piecePriceUpsell = $quoteTotalUpsell / $d['qty'];
    $priceDiff = $piecePrice - $piecePriceUpsell;
    $totalSavings = $quoteTotal - $quoteTotalUpsell;
    if($piecePriceUpsell < $piecePrice){
      $returned['upsell']['piecePriceFormatted'] = formatMoney(number_format($piecePriceUpsell, 2, '.', ''));
      $returned['upsell']['quoteTotalFormatted'] = formatMoney(number_format($quoteTotalUpsell, 2, '.', ''));
      $returned['upsell']['perPieceSavingsFormatted'] = formatMoney(number_format($priceDiff, 2, '.', ''));
      $returned['upsell']['totalSavingsFormatted'] = formatMoney(number_format($totalSavings, 2, '.', ''));
      $returned['upsell']['remainingToUpsell'] = $d["remainingToUpsell"];
    }
  }
  
  $returned['itemPrice'] = $printPrice;
  $returned['piecePrice'] = $piecePrice;
  $returned['taxTotal'] = $taxTotal;
  $returned['quoteTotal'] = $quoteTotal;
  $returned['taxTotalFormatted'] = formatMoney(number_format($taxTotal, 2, '.', ''));
  $returned['itemPriceFormatted'] = formatMoney($printPrice);
  $returned['piecePriceFormatted'] = formatMoney(number_format($piecePrice, 2, '.', ''));
  $returned['quoteTotalFormatted'] = formatMoney(number_format($quoteTotal, 2, '.', ''));
  $returned['itemName'] = $garmentArray[$d['garmentType']]["info"][$c]['garName'];
  $returned['itemPhoto'] = $accompanyImages[$garmentArray[$d['garmentType']]["accImm"][0]];

    if($garmentArray[$d['garmentType']]["link"][0] != ""){
      $returned['itemLink'] = $garmentArray[$d['garmentType']]["link"][0];
    }

  if(is_numeric($d['discCode'])){
  	$discount = $quoteTotal * (($d['discCode'])/100);
  	$discountTotal = $quoteTotal - $discount;
  	$discountPiece = ($discountTotal)/$d['qty'];

  	$quoteTotal = $discountTotal;
  	$piecePrice = $discountPiece;
    
    $returned['discountPiece'] = number_format($discountPiece, 2, '.', '');
  	$returned['discountTotal'] = number_format($discountTotal, 2, '.', '');
  	$returned['discountPieceFormatted'] = formatMoney(number_format($discountPiece, 2, '.', ''));
  	$returned['discountTotalFormatted'] = formatMoney(number_format($discountTotal, 2, '.', ''));
  }
  return $returned;
}

$args = array();
$args["qty"] = $qty;
$args["qtyVar"] = $qtyVar;
$args["nextBreak"] = $nextBreak;
$args["locationMrkUps"] = $locationMrkUps;
$args["garmentMarkUp"] = $garmentMarkUp;
$args["garmentType"] = $garmentType;
$args["printColors_front"] = $printColors_front;
$args["printColors_back"] = $printColors_back;
$args["printColors_left"] = $printColors_left;
$args["printColors_right"] = $printColors_right;
$args["printColors_other"] = $printColors_other;
$args["discCode"] = $discCode;
$args["taxDeduct"] = $taxDeduct;
$args["remainingToUpsell"] = $remainingToUpsell;



  for($q = 0; $q < count($garmentArray[$garmentType]['info']); $q++){
    $data['items'][$q] = doGarmentCalc($args,$q,$priceArray,$garmentArray);
  }
$data["error"] = false;

}else{
	$data["error"] = true;
	$data["errorText"] = "Quantity must be 12 or more. For one offs or Prototypes please give us a call.";
}

function cost_compare($a, $b)
{
 
  if ($a['itemPrice'] == $b['itemPrice']) {
          return 0;
      }
      return ($a['itemPrice'] < $b['itemPrice']) ? -1 : 1;
   
}

include("db.php");

if(isset($_POST[customItem])){
	$finalGarDesc = $_POST[customItem];
}else{
	$finalGarDesc = $garmentArray[$garmentType]["info"][$garmentStyle]["garName"];
}

// ORDER RESULTS BY LOWEST TO HIGHEST
uasort($data['items'], 'cost_compare');

// prepare query for data entry

$printInfo = array("item_type"=>"garment","colors_front"=>$printColors_front,"colors_back"=>$printColors_back,"colors_left"=>$printColors_left,"colors_right"=>$printColors_right,"colors_other"=>$printColors_other,"garment_type"=>$finalGarDesc,"discount"=>$discCode);

$sql2 = "INSERT INTO `price_quotes` (`ip_address`, `qty`,`piece_price`,`total_tax`,`total_price`,`printing_info`,`error_msg`)
VALUES ('".getRealIpAddr()."', '$qty','".$data[items][0][piecePrice]."','".$data[items][0][taxTotal]."','".$data[items][0][quoteTotal]."','".serialize($data['items'])."','".serialize($data['error'])."');";


// send back data if everything goes ok.
      
    //if(mysql_query($sql2)){
		 	$encoded = json_encode($data);
		  die($encoded);
	   //}else{
		//  $data["errorText"] = "We encountered an error. Please try again.";  
	  //}
	 
?>